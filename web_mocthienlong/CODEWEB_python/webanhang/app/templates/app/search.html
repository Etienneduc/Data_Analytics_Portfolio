{% extends "app/base.html" %}
{% load static %}
{% load humanize %}

{% block search %}

<div class="container py-4">
    <h4 class="text-center mb-4">K·∫øt qu·∫£ t√¨m ki·∫øm cho: <span class="text-primary">"{{ searched }}"</span></h4>
  
  
    <div class="row justify-content-center">
      {% for product in keys %}
        <div class="col-lg-3 col-md-4 col-sm-6 d-flex justify-content-center mb-4">
          <div class="card shadow-sm border-0 rounded-4" style="width: 100%; max-width: 320px;">
            <img src="{{ product.image.url }}" class="card-img-top rounded-top-4" alt="{{ product.name }}">
            <div class="card-body d-flex flex-column text-center">
              <h5 class="card-title fw-semibold text-dark">{{ product.name }}</h5>
              <p class="text-danger fw-bold fs-5 mb-3">{{ product.price|floatformat:0|intcomma}}‚Ç´</p>
              <div class="mt-auto d-flex justify-content-between gap-2">
                <button data-product="{{ product.id }}" data-action="add" class="btn btn-outline-primary btn-sm update-cart">üõí Th√™m v√†o gi·ªè</button>
                <a href="{% url 'detail' %}?id={{product.id}}" class="btn btn-outline-success btn-sm">üëÅ Xem</a>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
  

<style>
    .cart-badge-update {
        animation: badge-blink 0.5s ease-out;
      }
      
      @keyframes badge-blink {
        0% {
          background-color: red;
          transform: scale(1.2);
        }
        50% {
          background-color: #ffc107;
          transform: scale(1);
        }
        100% {
          background-color: red;
          transform: scale(1.2);
        }
      }
      
</style>



<!-- ƒêo·∫°n m√£ JavaScript t√¨m ki·∫øm -->
<script>
document.getElementById('search-input').addEventListener('input', function() {
    const query = this.value;
    if (query.length > 2) { // Ch·ªâ th·ª±c hi·ªán t√¨m ki·∫øm khi nh·∫≠p √≠t nh·∫•t 3 k√Ω t·ª±
        fetch(`/search/?searched=${query}`, {
            method: 'GET',
        })
        .then(response => response.json())
        .then(data => {
            const suggestions = document.getElementById('search-suggestions');
            suggestions.innerHTML = ''; // X√≥a c√°c g·ª£i √Ω c≈©
            if (data.keys.length > 0) {
                suggestions.style.display = 'block';
                data.keys.forEach(item => {
                    const div = document.createElement('div');
                    div.classList.add('list-group-item');
                    div.textContent = item.name;
                    suggestions.appendChild(div);
                });
            } else {
                suggestions.style.display = 'none'; // N·∫øu kh√¥ng c√≥ k·∫øt qu·∫£, ·∫©n g·ª£i √Ω
            }
        })
        .catch(error => console.error('Error fetching search suggestions:', error));
    } else {
        document.getElementById('search-suggestions').style.display = 'none';
    }
});
</script>

{% endblock search %}
